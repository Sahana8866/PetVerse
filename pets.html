<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üêæ Adopt a Pet | PetVerse</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script src="/translations.js"></script>
  <script src="/auth.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="logo">PetVerse üêæ</div>
    <ul>
        <li><a href="index.html" data-i18n="nav_home">Home</a></li>
        <li><a href="pets.html" data-i18n="nav_adopt">Adopt</a></li>
        <li><a href="volunteer.html" data-i18n="nav_volunteer">Volunteer</a></li>
        <li><a href="donate.html" data-i18n="nav_donate">Donate</a></li>
        <li><a href="community.html" data-i18n="nav_community">Community</a></li>
        <li><a href="lost-found.html" data-i18n="nav_lost_found">Lost & Found</a></li>
        <li><a href="login.html" id="loginLink" data-i18n="nav_login">Login / Signup</a></li>
        <li><a href="myadoptions.html" data-i18n="nav_my_adoptions">My Adoptions</a></li>
        <li id="logoutItem" style="display: none;">
            <a href="javascript:void(0)" id="logoutLink" style="color: var(--secondary);" data-i18n="nav_logout">Logout</a>
        </li>
        <li>
            <select id="languageSelect" onchange="changeLanguage(this.value)" style="background: var(--primary-light); color: white; border: none; padding: 0.5rem; border-radius: var(--radius);">
                <option value="en">English</option>
                <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
            </select>
        </li>
    </ul>
</nav>

  <div class="hero">
    <h1>Find Your Perfect Companion</h1>
    <p>Give a loving home to pets waiting for their forever family</p>
  </div>

  <!-- Category Filter -->
  <div class="category-filter">
    <button class="category-btn active" onclick="filterPets('all')">All Pets</button>
    <button class="category-btn" onclick="filterPets('dog')">Dogs üêï</button>
    <button class="category-btn" onclick="filterPets('cat')">Cats üêà</button>
    <button class="category-btn" onclick="filterPets('bird')">Birds üê¶</button>
    <button class="category-btn" onclick="filterPets('rabbit')">Rabbits</button>
  </div>

  <!-- Pets Grid -->
  <div id="pets-container" class="pets-grid">Loading pets...</div>

  <div id="toast" class="toast"></div>

  <script>
    const container = document.getElementById("pets-container");
    const toast = document.getElementById("toast");
    const backendURL = "http://127.0.0.1:5000";
    let allPets = [];

    // Update login/logout links based on user state
    function updateAuthLinks() {
      const user = localStorage.getItem("petpal_user");
      const loginLink = document.getElementById("loginLink");
      const logoutItem = document.getElementById("logoutItem");
      const logoutLink = document.getElementById("logoutLink");

      if (user) {
        loginLink.innerHTML = `Welcome, ${user} üëã`;
        loginLink.style.color = "var(--accent)";
        loginLink.href = "javascript:void(0)";
        loginLink.onclick = () => showToast(`Already logged in as ${user}`);
        logoutItem.style.display = "block";
        logoutLink.onclick = logout;
      } else {
        loginLink.innerHTML = "Login / Signup";
        loginLink.style.color = "";
        loginLink.href = "login.html";
        loginLink.onclick = null;
        logoutItem.style.display = "none";
      }
    }

    function logout() {
      const user = localStorage.getItem("petpal_user");
      localStorage.removeItem("petpal_user");
      showToast(`Goodbye, ${user}! You have been logged out.`);
      updateAuthLinks();
      setTimeout(() => window.location.href = "index.html", 1500);
    }

    function showToast(message, type = 'info') {
      toast.innerText = message;
      toast.style.background = type === 'error' ? '#ff6b6b' : 
                              type === 'success' ? 'var(--accent)' : 'var(--primary)';
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 3000);
    }

    function filterPets(category) {
      document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      const filteredPets = category === 'all' ? allPets : allPets.filter(pet => 
        pet.type.toLowerCase().includes(category)
      );
      
      displayPets(filteredPets);
    }

    function displayPets(pets) {
      container.innerHTML = "";
      
      if (pets.length === 0) {
        container.innerHTML = '<p style="text-align: center; grid-column: 1/-1; color: var(--text-light);">No pets found in this category.</p>';
        return;
      }

      pets.forEach(pet => {
        const card = document.createElement("div");
        card.className = "pet-card";
        card.setAttribute('data-category', pet.type.toLowerCase());

        card.innerHTML = `
          <img src="${backendURL}${pet.image}" alt="${pet.name}" onerror="this.src='https://via.placeholder.com/300x200/8B5FBF/FFFFFF?text=Pet+Image'">
          <div class="pet-card-content">
            <h3>${pet.name}</h3>
            <span class="type">${pet.type}</span>
            <div class="details">
              <p><strong>Age:</strong> ${pet.age}</p>
              <p><strong>Description:</strong> ${pet.description}</p>
            </div>
            <button class="adopt-btn" data-id="${pet.id}">Adopt ${pet.name}</button>
          </div>
        `;

        card.querySelector('.adopt-btn').addEventListener('click', async (e) => {
          e.stopPropagation();
          const user = localStorage.getItem("petpal_user");
          const petId = e.target.dataset.id;

          if (!user) {
            showToast("Please login to adopt a pet üêæ");
            return;
          }

          try {
            const res = await fetch(`${backendURL}/api/adopt`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ user_name: user, pet_id: petId })
            });

            const data = await res.json();
            if (data.error) {
              showToast(data.error, 'error');
            } else {
              showToast(data.message, 'success');
              card.style.display = 'none';
            }
          } catch (err) {
            showToast("Adoption failed. Please try again.", 'error');
          }
        });

        container.appendChild(card);
      });
    }

    async function loadPets() {
      try {
        const res = await fetch(`${backendURL}/api/pets`);
        if (!res.ok) throw new Error(`Backend returned ${res.status}`);
        allPets = await res.json();
        displayPets(allPets);
      } catch (err) {
        container.innerHTML = "<p style='text-align: center; grid-column: 1/-1; color: var(--text-light);'>‚ö†Ô∏è Failed to load pets. Please try again later.</p>";
        console.error("Error fetching pets:", err);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateAuthLinks();
      loadPets();
    });
  </script>
  <!-- Include these in ALL pages -->
<script src="/header.js"></script>
<script src="/translations.js"></script>
<div id="toast" class="toast"></div>

<script>
// Temporary fix - add this to every page until you create the separate files
function updateAuthLinks() {
    const user = localStorage.getItem("petpal_user");
    const loginLink = document.getElementById("loginLink");
    const logoutItem = document.getElementById("logoutItem");
    const logoutLink = document.getElementById("logoutLink");

    if (user && loginLink) {
        loginLink.innerHTML = `Welcome, ${user} üëã`;
        loginLink.style.color = "var(--accent)";
        loginLink.href = "javascript:void(0)";
        loginLink.onclick = () => showToast(`Already logged in as ${user}`);
        
        if (logoutItem && logoutLink) {
            logoutItem.style.display = "block";
            logoutLink.onclick = logout;
        }
    }
}

function logout() {
    const user = localStorage.getItem("petpal_user");
    localStorage.removeItem("petpal_user");
    showToast(`Goodbye, ${user}! You have been logged out.`);
    setTimeout(() => window.location.href = "index.html", 1500);
}

function showToast(message) {
    let toast = document.getElementById("toast");
    if (!toast) {
        toast = document.createElement("div");
        toast.id = "toast";
        toast.className = "toast";
        document.body.appendChild(toast);
    }
    toast.innerText = message;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 3000);
}

document.addEventListener('DOMContentLoaded', updateAuthLinks);
</script>
<div id="toast" class="toast"></div>

</body>
</html>